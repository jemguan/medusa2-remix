import{D as Y,u as Q,c as U,a as G}from"./chunk-43PRAFWA-ggMuEKcf.js";import{g as Z}from"./chunk-OIAPXGI2-CwJkVoCw.js";import{P as X}from"./chunk-AM2BU2RH-Jz_rw4zs.js";import{S as m}from"./chunk-LFLGEXIG-CRH6mmi7.js";import{T as L}from"./chunk-2RQLKDBF-ByAB-Zu3.js";import{Q as V,j as e,q as ee,d as te,R as se,a as I,S as ae,p as ie,s as ne,b as v,H as _,A as C,u as q,f as re,r as w,U as le,m as W,V as O,L as B,T as N,B as oe,W as ce,Y as E,J as de,Z as ue,_ as F,$ as me,a0 as pe,k as xe}from"./index-Br7KcgVZ.js";import{u as he}from"./chunk-C76H5USB-snx4tQYu.js";import{P as A}from"./chunk-UF3RZ3OU-Qx3Youao.js";import{P as b}from"./pencil-square-DvX6HK1G.js";import{S as ve}from"./status-badge-PaBe6mve.js";import{T as M}from"./trash-CF90J7Pj.js";import{T as fe}from"./thumbnail-badge-CT0z0A75.js";import{C as ge}from"./channels-DjS_dmg3.js";import{T as je}from"./Trans-D_-MLUQW.js";import{C as H}from"./component-BZ-FIySZ.js";import{u as $}from"./use-prompt-BJQZ-chh.js";import{C as S}from"./container-DT4nbkLO.js";import{C as ye}from"./checkbox-CuKUmx-V.js";import{C as D}from"./command-bar-D4WdMclT.js";import"./index-CTi5Aiew.js";import"./chunk-EPATMX2O-Fnr0vyLv.js";import"./format-Bc3Z-myT.js";import"./table-Oe8J9KZe.js";import"./arrow-up-mini-Dqi2bbQJ.js";import"./date-picker-DwI7Qf6K.js";import"./clsx-B-dksMZM.js";import"./popover-ntoiPHLH.js";import"./index-DTt8xJH5.js";import"./x-mark-mini-7wDt4qdT.js";import"./triangle-left-mini-BCF8TRqK.js";import"./check-C_q2Aw8o.js";import"./prompt-BFK30w09.js";const be=()=>({command:s=>s});var ht=s=>{const{id:t}=s.params||{},{product:a}=V(t,{fields:A},{initialData:s.data,enabled:!!t});return a?e.jsx("span",{children:a.title}):null},we=s=>({queryKey:ie.detail(s,{fields:A}),queryFn:async()=>ne.admin.product.retrieve(s,{fields:A})}),vt=async({params:s})=>{const t=s.id,a=we(t);return await ee.ensureQueryData({...a,staleTime:9e4})},Ce=({product:s})=>{const{t}=v(),{getDisplays:a}=I();return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{level:"h2",children:t("products.attributes")}),e.jsx(C,{groups:[{actions:[{label:t("actions.edit"),to:"attributes",icon:e.jsx(b,{})}]}]})]}),e.jsx(m,{title:t("fields.height"),value:s.height}),e.jsx(m,{title:t("fields.width"),value:s.width}),e.jsx(m,{title:t("fields.length"),value:s.length}),e.jsx(m,{title:t("fields.weight"),value:s.weight}),e.jsx(m,{title:t("fields.midCode"),value:s.mid_code}),e.jsx(m,{title:t("fields.hsCode"),value:s.hs_code}),e.jsx(m,{title:t("fields.countryOfOrigin"),value:Z(s.origin_country)}),a("product","attributes").map((i,l)=>e.jsx(i,{data:s},l))]})},Se=s=>{switch(s){case"draft":return"grey";case"proposed":return"orange";case"published":return"green";case"rejected":return"red";default:return"grey"}},Ne=({product:s})=>{const{t}=v(),a=$(),i=q(),{getDisplays:l}=I(),r=l("product","general"),{mutateAsync:d}=re(s.id),u=async()=>{await a({title:t("general.areYouSure"),description:t("products.deleteWarning",{title:s.title}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await d(void 0,{onSuccess:()=>{i("..")}})};return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{children:s.title}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(ve,{color:Se(s.status),children:t(`products.productStatus.${s.status}`)}),e.jsx(C,{groups:[{actions:[{label:t("actions.edit"),to:"edit",icon:e.jsx(b,{})}]},{actions:[{label:t("actions.delete"),onClick:u,icon:e.jsx(M,{})}]}]})]})]}),e.jsx(m,{title:t("fields.description"),value:s.description}),e.jsx(m,{title:t("fields.subtitle"),value:s.subtitle}),e.jsx(m,{title:t("fields.handle"),value:`/${s.handle}`}),e.jsx(m,{title:t("fields.discountable"),value:s.discountable?t("fields.true"):t("fields.false")}),r.map((h,n)=>e.jsx(h,{data:s},n))]})},_e=({product:s})=>{const{t}=v(),a=$(),[i,l]=w.useState({}),r=ke(s),d=n=>{l(o=>{if(o[n]){const{[n]:c,...p}=o;return p}else return{...o,[n]:!0}})},{mutateAsync:u}=le(s.id),h=async()=>{const n=Object.keys(i),o=n.some(x=>{var f;return(f=r.find(j=>j.id===x))==null?void 0:f.isThumbnail});if(!await a({title:t("general.areYouSure"),description:o?t("products.media.deleteWarningWithThumbnail",{count:n.length}):t("products.media.deleteWarning",{count:n.length}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")}))return;const p=s.images.filter(x=>!n.includes(x.id)).map(x=>({url:x.url}));await u({images:p,thumbnail:o?"":void 0},{onSuccess:()=>{l({})}})};return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{level:"h2",children:t("products.media.label")}),e.jsx(C,{groups:[{actions:[{label:t("actions.edit"),to:"media?view=edit",icon:e.jsx(b,{})}]}]})]}),r.length>0?e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(96px,1fr))] gap-4 px-6 py-4",children:r.map((n,o)=>{const c=i[n.id];return e.jsxs("div",{className:"shadow-elevation-card-rest hover:shadow-elevation-card-hover transition-fg group relative aspect-square size-full cursor-pointer overflow-hidden rounded-[8px]",children:[e.jsx("div",{className:W("transition-fg invisible absolute right-2 top-2 opacity-0 group-hover:visible group-hover:opacity-100",{"visible opacity-100":c}),children:e.jsx(ye,{checked:i[n.id]||!1,onCheckedChange:()=>d(n.id)})}),n.isThumbnail&&e.jsx("div",{className:"absolute left-2 top-2",children:e.jsx(O,{content:t("fields.thumbnail"),children:e.jsx(fe,{})})}),e.jsx(B,{to:"media",state:{curr:o},children:e.jsx("img",{src:n.url,alt:`${s.title} image`,className:"size-full object-cover"})})]},n.id)})}):e.jsxs("div",{className:"flex flex-col items-center gap-y-4 pb-8 pt-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(N,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-subtle",children:t("products.media.emptyState.header")}),e.jsx(N,{size:"small",className:"text-ui-fg-muted",children:t("products.media.emptyState.description")})]}),e.jsx(oe,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(B,{to:"media?view=edit",children:t("products.media.emptyState.action")})})]}),e.jsx(D,{open:!!Object.keys(i).length,children:e.jsxs(D.Bar,{children:[e.jsx(D.Value,{children:t("general.countSelected",{count:Object.keys(i).length})}),e.jsx(D.Seperator,{}),e.jsx(D.Command,{action:h,label:t("actions.delete"),shortcut:"d"})]})})]})},ke=s=>{const{images:t=[],thumbnail:a}=s,i=t.map(l=>({id:l.id,url:l.url,isThumbnail:l.url===a}));return a&&!i.some(l=>l.url===a)&&i.unshift({id:"img_thumbnail",url:a,isThumbnail:!0}),i},Te=({product:s,option:t})=>{const{t:a}=v(),{mutateAsync:i}=pe(s.id,t.id),l=$(),r=async()=>{await l({title:a("general.areYouSure"),description:a("products.options.deleteWarning",{title:t.title}),confirmText:a("actions.delete"),cancelText:a("actions.cancel")})&&await i()};return e.jsx(C,{groups:[{actions:[{label:a("actions.edit"),to:`options/${t.id}/edit`,icon:e.jsx(b,{})}]},{actions:[{label:a("actions.delete"),onClick:r,icon:e.jsx(M,{})}]}]})},De=({product:s})=>{var a;const{t}=v();return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{level:"h2",children:t("products.options.header")}),e.jsx(C,{groups:[{actions:[{label:t("actions.create"),to:"options/create",icon:e.jsx(ce,{})}]}]})]}),(a=s.options)==null?void 0:a.map(i=>{var l;return e.jsx(m,{title:i.title,value:(l=i.values)==null?void 0:l.map(r=>e.jsx(E,{size:"2xsmall",className:"flex min-w-[20px] items-center justify-center",children:r.value},r.value)),actions:e.jsx(Te,{product:s,option:i})},i.id)})]})},Pe=({product:s})=>{var i,l;const{t}=v(),{getDisplays:a}=I();return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{level:"h2",children:t("products.organization.header")}),e.jsx(C,{groups:[{actions:[{label:t("actions.edit"),to:"organization",icon:e.jsx(b,{})}]}]})]}),e.jsx(m,{title:t("fields.tags"),value:(i=s.tags)!=null&&i.length?s.tags.map(r=>e.jsx(z,{label:r.value,to:`/settings/product-tags/${r.id}`},r.id)):void 0}),e.jsx(m,{title:t("fields.type"),value:s.type?e.jsx(z,{label:s.type.value,to:`/settings/product-types/${s.type_id}`}):void 0}),e.jsx(m,{title:t("fields.collection"),value:s.collection?e.jsx(z,{label:s.collection.title,to:`/collections/${s.collection.id}`}):void 0}),e.jsx(m,{title:t("fields.categories"),value:(l=s.categories)!=null&&l.length?s.categories.map(r=>e.jsx(z,{label:r.name,to:`/categories/${r.id}`},r.id)):void 0}),a("product","organize").map((r,d)=>e.jsx(r,{data:s},d))]})},z=({label:s,to:t})=>e.jsx(O,{content:s,children:e.jsx(E,{size:"2xsmall",className:"block w-fit truncate",asChild:!0,children:e.jsx(B,{to:t,children:s})})}),ze=({product:s})=>{var d;const{count:t}=de(),{t:a}=v(),i=((d=s.sales_channels)==null?void 0:d.map(u=>({id:u.id,name:u.name})))??[],l=i.slice(0,3),r=i.slice(3);return e.jsxs(S,{className:"flex flex-col gap-y-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{level:"h2",children:a("fields.sales_channels")}),e.jsx(C,{groups:[{actions:[{label:a("actions.edit"),to:"sales-channels",icon:e.jsx(b,{})}]}]})]}),e.jsxs("div",{className:"grid grid-cols-[28px_1fr] items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:e.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:e.jsx(ge,{className:"text-ui-fg-subtle"})})}),i.length>0?e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(N,{size:"small",leading:"compact",children:l.map(u=>u.name).join(", ")}),r.length>0&&e.jsx(O,{content:e.jsx("ul",{children:r.map(u=>e.jsx("li",{children:u.name},u.id))}),children:e.jsx(N,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:`+${r.length}`})})]}):e.jsx(N,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:a("products.noSalesChannels")})]}),e.jsx("div",{children:e.jsx(N,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:e.jsx(je,{i18nKey:"sales_channels.availableIn",values:{x:i.length,y:t??0},components:[e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"x"),e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"y")]})})})]})},K=10,Ae=({product:s})=>{const{t}=v(),{q:a,order:i,offset:l,allow_backorder:r,manage_inventory:d,created_at:u,updated_at:h}=he(["q","order","offset","manage_inventory","allow_backorder","created_at","updated_at"]),n=Ie(s),o=Oe(),c=Le(),{variants:p,count:x,isPending:f,isError:j,error:g}=ue(s.id,{q:a,order:i||"variant_rank",offset:l?parseInt(l):void 0,limit:K,allow_backorder:r?JSON.parse(r):void 0,manage_inventory:d?JSON.parse(d):void 0,created_at:u?JSON.parse(u):void 0,updated_at:h?JSON.parse(h):void 0,fields:"*inventory_items.inventory.location_levels,+inventory_quantity"},{placeholderData:xe});if(j)throw g;return e.jsx(S,{className:"divide-y p-0",children:e.jsx(Y,{data:p,columns:n,filters:o,rowCount:x,getRowId:y=>y.id,rowHref:y=>`/products/${s.id}/variants/${y.id}`,pageSize:K,isLoading:f,heading:t("products.variants.header"),emptyState:{empty:{heading:t("products.variants.empty.heading"),description:t("products.variants.empty.description")},filtered:{heading:t("products.variants.filtered.heading"),description:t("products.variants.filtered.description")}},action:{label:t("actions.create"),to:"variants/create"},actionMenu:{groups:[{actions:[{label:t("products.editPrices"),to:"prices",icon:e.jsx(b,{})},{label:t("inventory.stock.action"),to:"stock",icon:e.jsx(F,{})}]}]},commands:c})})},P=U(),Ie=s=>{const{t}=v(),a=q(),{mutateAsync:i}=me(s.id),l=$(),r=w.useCallback(async(n,o)=>{await l({title:t("general.areYouSure"),description:t("products.deleteVariantWarning",{title:o}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await i({variantId:n})},[i,l,t]),d=w.useMemo(()=>s!=null&&s.options?s.options.map(n=>P.display({id:n.id,header:n.title,cell:({row:o})=>{var p;const c=(p=o.original.options)==null?void 0:p.find(x=>x.option_id===n.id);return c?e.jsx("div",{className:"flex items-center",children:e.jsx(O,{content:c.value,children:e.jsx(E,{size:"2xsmall",title:c.value,className:"inline-flex min-w-[20px] max-w-[140px] items-center justify-center overflow-hidden truncate",children:c.value})})}):e.jsx("span",{className:"text-ui-fg-muted",children:"-"})}})):[],[s]),u=w.useCallback(n=>{var f,j;const o=n.row.original,c=[{icon:e.jsx(b,{}),label:t("actions.edit"),onClick:g=>{a(`edit-variant?variant_id=${g.row.original.id}`)}}],p=[{icon:e.jsx(M,{}),label:t("actions.delete"),onClick:()=>r(o.id,o.title)}];switch(((f=o.inventory_items)==null?void 0:f.length)||0){case 0:break;case 1:{const g=`/inventory/${o.inventory_items[0].inventory.id}`;c.push({label:t("products.variant.inventory.actions.inventoryItems"),onClick:()=>{a(g)},icon:e.jsx(F,{})});break}default:{const g=(j=o.inventory_items)==null?void 0:j.map(k=>{var T;return(T=k.inventory)==null?void 0:T.id});if(!g||g.length===0)break;const y=`/inventory?${new URLSearchParams({id:g.join(",")}).toString()}`;c.push({label:t("products.variant.inventory.actions.inventoryKit"),onClick:()=>{a(y)},icon:e.jsx(H,{})})}}return[c,p]},[r,a,t]),h=w.useCallback(n=>{var y;const o=n,c=n.inventory_quantity,p=(y=o.inventory_items)==null?void 0:y.map(k=>k.inventory).filter(Boolean),x=p.length>1,f={};p.forEach(k=>{var T;(T=k.location_levels)==null||T.forEach(J=>{f[J.id]=!0})});const j=Object.keys(f).length;return{text:x?t("products.variant.tableItemAvailable",{availableCount:c}):t("products.variant.tableItem",{availableCount:c,locationCount:j,count:j}),hasInventoryKit:x,quantity:c}},[t]);return w.useMemo(()=>[P.accessor("title",{header:t("fields.title"),enableSorting:!0,sortAscLabel:t("filters.sorting.alphabeticallyAsc"),sortDescLabel:t("filters.sorting.alphabeticallyDesc")}),P.accessor("sku",{header:t("fields.sku"),enableSorting:!0,sortAscLabel:t("filters.sorting.alphabeticallyAsc"),sortDescLabel:t("filters.sorting.alphabeticallyDesc")}),...d,P.display({id:"inventory",header:t("fields.inventory"),cell:({row:n})=>{const{text:o,hasInventoryKit:c,quantity:p}=h(n.original);return e.jsxs("div",{className:"flex h-full w-full items-center gap-2 overflow-hidden",children:[c&&e.jsx(H,{}),e.jsx("span",{className:W("truncate",{"text-ui-fg-error":!p}),title:o,children:o})]})}}),P.action({actions:u})],[t,d,u,h])},R=G(),Oe=()=>{const{t:s}=v(),t=Q();return w.useMemo(()=>[R.accessor("allow_backorder",{type:"radio",label:s("fields.allowBackorder"),options:[{label:s("filters.radio.yes"),value:"true"},{label:s("filters.radio.no"),value:"false"}]}),R.accessor("manage_inventory",{type:"radio",label:s("fields.manageInventory"),options:[{label:s("filters.radio.yes"),value:"true"},{label:s("filters.radio.no"),value:"false"}]}),...t],[s,t])},$e=be(),Le=()=>{const{t:s}=v(),t=q();return[$e.command({label:s("inventory.stock.action"),shortcut:"i",action:async a=>{t(`stock?${X}=${Object.keys(a).join(",")}`)}})]},ft=()=>{const s=te(),{id:t}=se(),{product:a,isLoading:i,isError:l,error:r}=V(t,{fields:A},{initialData:s}),{getWidgets:d}=I(),u=d("product.details.after"),h=d("product.details.before"),n=d("product.details.side.after"),o=d("product.details.side.before");if(i||!a)return e.jsx(ae,{mainSections:4,sidebarSections:3,showJSON:!0,showMetadata:!0});if(l)throw r;return e.jsxs(L,{widgets:{after:u,before:h,sideAfter:n,sideBefore:o},showJSON:!0,showMetadata:!0,data:a,children:[e.jsxs(L.Main,{children:[e.jsx(Ne,{product:a}),e.jsx(_e,{product:a}),e.jsx(De,{product:a}),e.jsx(Ae,{product:a})]}),e.jsxs(L.Sidebar,{children:[e.jsx(ze,{product:a}),e.jsx(Pe,{product:a}),e.jsx(Ce,{product:a})]})]})};export{ht as Breadcrumb,ft as Component,vt as loader};
